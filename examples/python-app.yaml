# Example: Python Application Pipeline
# Copy this to your app's .github/workflows/ci.yaml

name: CI

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deploy to environment'
        type: choice
        options:
          - dev
          - stg
          - prd
        required: false

# Prevent duplicate runs: cancel in-progress runs when new commits are pushed
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

env:
  APP_NAME: my-python-app
  PROJECT: data-platform

jobs:
  build-and-deploy:
    name: Build & Deploy
    uses: mrops-br/gha-workflows/.github/workflows/_pipeline-python.yaml@main
    with:
      app-name: ${{ env.APP_NAME }}
      project: ${{ env.PROJECT }}
      gitops-repo: mrops-br/gitops-${{ env.PROJECT }}
      python-version: '3.12'
      package-manager: 'pip'
      working-directory: '.'
      dockerfile: 'Dockerfile'
      enable-lint: true
      enable-type-check: true
      enable-test: true
      enable-coverage: true
      deploy-environment: ${{ inputs.environment }}
    secrets: inherit
